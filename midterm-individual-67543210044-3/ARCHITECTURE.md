# สถาปัตยกรรม (Architecture) ของระบบจัดการข้อมูลนักศึกษา

เอกสารนี้อธิบายสถาปัตยกรรมของโปรเจกต์ `layered-student` โดยใช้แนวคิดของ C4 Model ในระดับ C1 (Context) และ C2 (Container) เพื่อให้เห็นภาพรวมของระบบ

---

## 1. C1: System Context Diagram

ไดอะแกรมบริบทของระบบ (Context Diagram) แสดงภาพรวมว่าระบบของเรามีปฏิสัมพันธ์กับผู้ใช้ (Actor) หรือระบบอื่น ๆ ภายนอกอย่างไร

ในที่นี้ ระบบ "Student Management System" เป็นระบบศูนย์กลางที่ผู้ใช้ (นักศึกษา, อาจารย์ หรือเจ้าหน้าที่) สามารถเข้ามาจัดการข้อมูลนักศึกษาผ่านเว็บเบราว์เซอร์ได้
```text
┌─────────────────────────────────────────────────────┐
│                                                     │
│                    System User                      │
│        (นักศึกษา, อาจารย์, เจ้าหน้าที่)                   │
│                                                     │
└────────────┬────────────────────────────────────────┘
             │
             │ HTTP/JSON
             │ (CRUD Operations)
             │
             ▼
┌─────────────────────────────────────────────────────┐
│                                                     │
│           Student Management System                 │
│                                                     │
│  • จัดการข้อมูลนักศึกษา (CRUD)                          │
│  • คำนวณ GPA เฉลี่ย                                   │
│  • กรองนักศึกษาตามคณะและสถานะ                        │
│  • แสดงสถิตินักศึกษา                                   │
│                                                     │
└─────────────────────────────────────────────────────┘
```
---

## 2. C2: Container Diagram

ไดอะแกรมคอนเทนเนอร์ (Container Diagram) แสดงโครงสร้างภายในของ "Student Management System" ซึ่งประกอบไปด้วยส่วนประกอบหลัก ๆ ดังนี้
```text
┌─────────────────────────────────────────────────────┐
│                      User's Browser                 │
│                 (HTML, CSS, JavaScript)             │
└────────────┬────────────────────────────────────────┘
             │
             │ HTTPS
             │
             ▼
┌─────────────────────────────────────────────────────┐
│                                                     │
│              Web Application (Node.js)              │
│        (Presentation, Business, Data Layers)        │
│                                                     │
└────────────┬────────────────────────────────────────┘
             │
             │ SQL Queries
             │
             ▼
┌─────────────────────────────────────────────────────┐
│                                                     │
│              SQLite Database                        │
│               (students.db)                         │
│                                                     │
└─────────────────────────────────────────────────────┘

### โครงสร้างสถาปัตยกรรมแบบ Layered (ภายใน Web Application)
```


ตัว Web Application ถูกแบ่งออกเป็น 3 เลเยอร์อย่างชัดเจน ดังนี้



```
+-------------------------------------------------+
|               Presentation Layer                |
| (Controllers, Routes, Middlewares)              |
+-------------------------------------------------+
                        |
                        v
+-------------------------------------------------+
|                  Business Layer                 |
|            (Services, Validators)               |
+-------------------------------------------------+
                        |
                        v
+-------------------------------------------------+
|                    Data Layer                   |
|           (Repositories, Database)              |
+-------------------------------------------------+
```

---

## 3. Responsibilities ของแต่ละ Layer

แต่ละเลเยอร์มีหน้าที่และความรับผิดชอบที่ชัดเจน เพื่อลดการพึ่งพากัน (Coupling) และเพิ่มความสามารถในการดูแลรักษาและแก้ไขโค้ด (Maintainability)

### 3.1. Presentation Layer

-   **ที่อยู่**: `src/presentation/`
-   **หน้าที่หลัก**: รับผิดชอบเกี่ยวกับการโต้ตอบกับผู้ใช้ (User Interface) และการจัดการ HTTP Request/Response
-   **ส่วนประกอบ**:
    -   **Routes (`routes/`)**: กำหนดเส้นทาง (Endpoints) ของ API เช่น `/api/students/:id` และเชื่อมโยงกับ Controller ที่เหมาะสม
    -   **Controllers (`controllers/`)**: เป็นตัวกลางในการรับ HTTP Request จากนั้นเรียกใช้ Service ที่อยู่ใน Business Layer เพื่อประมวลผล และสุดท้ายทำการส่ง HTTP Response (ในรูปแบบ JSON) กลับไปให้ผู้ใช้
    -   **Middlewares (`middlewares/`)**: ใช้จัดการ Logic ที่ต้องทำซ้ำ ๆ ในหลายๆ Request เช่น การจัดการข้อผิดพลาด (Error Handling) หรือการตรวจสอบสิทธิ์ (Authentication)

### 3.2. Business Layer

-   **ที่อยู่**: `src/business/`
-   **หน้าที่หลัก**: เป็นหัวใจของแอปพลิเคชัน รับผิดชอบการประมวลผลตรรกะทางธุรกิจ (Business Logic) และการตรวจสอบความถูกต้องของข้อมูล (Validation) ตามกฎของธุรกิจ
-   **ส่วนประกอบ**:
    -   **Services (`services/`)**: ทำหน้าที่ประมวลผลทางธุรกิจที่ซับซ้อน เช่น การคำนวณสถิติ, การตรวจสอบเงื่อนไขก่อนลบข้อมูล (เช่น ห้ามลบนักศึกษาที่ยังเรียนอยู่) โดย Service จะเรียกใช้ Repository เพื่อจัดการกับข้อมูล
    -   **Validators (`validators/`)**: ตรวจสอบความถูกต้องของข้อมูลที่รับเข้ามาจาก Presentation Layer ก่อนที่จะส่งไปประมวลผลต่อ เช่น ตรวจสอบว่า ID เป็นตัวเลข, GPA อยู่ในขอบเขต 0-4.0, หรือ status เป็นค่าที่กำหนดไว้

### 3.3. Data Layer

-   **ที่อยู่**: `src/data/`
-   **หน้าที่หลัก**: รับผิดชอบเกี่ยวกับการเข้าถึงและจัดการข้อมูลในที่จัดเก็บข้อมูล (Data Storage) ซึ่งในโปรเจกต์นี้คือฐานข้อมูล SQLite
-   **ส่วนประกอบ**:
    -   **Repositories (`repositories/`)**: เป็น Abstraction Layer ที่ห่อหุ้มการเขียน SQL Query ทำให้ Business Layer ไม่ต้องรับรู้เกี่ยวกับโครงสร้างของฐานข้อมูลหรือภาษา SQL โดยตรง Repository จะมีเมธอดต่างๆ สำหรับการจัดการข้อมูล เช่น `findAll()`, `findById()`, `create()`, `update()`, `delete()`
    -   **Database (`database/`)**: จัดการการเชื่อมต่อกับฐานข้อมูล (Connection) และการตั้งค่าเริ่มต้น เช่น การสร้างตารางหากยังไม่มี

---

## 4. Data Flow (Request → Response)

เพื่อให้เห็นภาพการทำงานร่วมกันของแต่ละเลเยอร์ ตัวอย่างขั้นตอนการดึงข้อมูลนักศึกษาทั้งหมด (`GET /api/students`)

1.  **ผู้ใช้ (User)** ส่ง Request มาที่ `GET /api/students` จากเบราว์เซอร์
2.  **`server.js`** รับ Request และส่งต่อไปยัง Middleware ของ Express
3.  **[Presentation] `studentRoutes.js`**: ตรวจสอบเส้นทาง (Path) และพบว่าตรงกับ `GET /` จึงเรียกใช้ฟังก์ชัน `getAllStudents` ใน `studentController.js`
4.  **[Presentation] `studentController.js`**: ฟังก์ชัน `getAllStudents` ถูกเรียก และทำการเรียกเมธอด `getAllStudents()` จาก `studentService` ที่อยู่ใน Business Layer
5.  **[Business] `studentService.js`**:
    -   เมธอด `getAllStudents()` ถูกเรียก
    -   อาจมีการตรวจสอบ Query Parameters (เช่น `major`, `status`) โดยใช้ `studentValidator`
    -   จากนั้นเรียกใช้เมธอด `findAll()` จาก `studentRepository` ใน Data Layer เพื่อดึงข้อมูลนักศึกษาจากฐานข้อมูล
6.  **[Data] `studentRepository.js`**:
    -   เมธอด `findAll()` ทำการสร้างและรันคำสั่ง SQL (`SELECT * FROM students`) ผ่าน `connection.js`
    -   ฐานข้อมูล SQLite ประมวลผลและส่งผลลัพธ์กลับมา
7.  **[Data]** Repository ได้รับข้อมูลดิบจากฐานข้อมูล และส่งกลับไปยัง Service
8.  **[Business]** Service ได้รับข้อมูลจาก Repository และอาจมีการประมวลผลเพิ่มเติม เช่น คำนวณค่าสถิติ (ค่าเฉลี่ย GPA, จำนวนนักศึกษาแต่ละสถานะ) แล้วส่งผลลัพธ์ทั้งหมดกลับไปยัง Controller
9.  **[Presentation]** Controller ได้รับข้อมูลที่ประมวลผลเสร็จสิ้นแล้ว และทำการสร้าง HTTP Response โดยส่งข้อมูลกลับไปในรูปแบบ JSON พร้อมกับ Status Code `200 OK`
10. **ผู้ใช้ (User)** ได้รับข้อมูลนักศึกษาแสดงผลบนหน้าจอเบราว์เซอร์

หากมีข้อผิดพลาดเกิดขึ้นในขั้นตอนใด ๆ (เช่น ID ไม่พบในฐานข้อมูล, ข้อมูลไม่ถูกต้อง) `errorHandler.js` ซึ่งเป็น Middleware จะถูกเรียกใช้เพื่อส่ง Response ที่เป็น Error กลับไปอย่างเหมาะสม
